<?php

include("security.php");
include("security_level_check.php");
include("functions_external.php");
include("connect.php");

function sqli($data)
{

    switch ($_COOKIE["security_level"])
    {

        case "0" :

            $data = no_check($data);
            break;

        case "1" :

            $data = sqli_check_1($data);
            break;

        case "2" :

            $data = sqli_check_2($data);
            break;

        default :

            $data = no_check($data);
            break;
    }

    return $data;
}

if(!empty($_GET["title"]))
{

    // Retrieves the movie title
    $title = $_GET["title"];

    // Constructs the query
    $sql = "SELECT * FROM movies WHERE title LIKE '%" . sqli($title) . "%'";

    $recordset = $link->query($sql);

    if ($recordset->num_rows > 0)
    {
	    while($row = $recordset->fetch_assoc()) 
	    {
            	$movies[] = $row;
        }

    }

    else
    {

        $movies = array();

    }

}

else
{

    $movies = array();

}

header("Content-Type: text/json; charset=utf-8");

// Encodes the result to JSON
echo json_encode($movies);

?>
